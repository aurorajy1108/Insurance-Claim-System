<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Claim System</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <div class="header-content">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-chevron-left"></i>
            </button>
            <h1 class="header-title">File Claim</h1>
            <button class="help-btn">
                <i class="fas fa-question-circle"></i>
            </button>
        </div>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-steps">
            <div class="step active">
                <span class="step-number">1</span>
                <span class="step-text">Report</span>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <span class="step-text">Payment Info</span>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <span class="step-text">Upload Documents</span>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Step 1: Report Information -->
        <section id="step-1" class="form-section active">
            <h2 class="section-title">Who is filing the claim? <span class="subtitle">Who got injured? Please select who is filing the claim~</span></h2>
            
            <!-- Applicant Type Selection -->
            <div class="applicant-type">
                <button class="type-btn active" data-type="self">Self</button>
                <button class="type-btn" data-type="spouse">Spouse</button>
                <button class="type-btn" data-type="parent">Parent</button>
                <button class="type-btn" data-type="child">Child</button>
                <button class="type-btn" data-type="pet">Pet</button>
                <button class="type-btn" data-type="other">Other</button>
            </div>

            <!-- Insured Person Information -->
            <div class="form-group">
                <label class="form-label">Insured Person Name</label>
                <input type="text" id="insured-name" class="form-input" placeholder="Enter insured person's name">
                <button class="voice-input-btn">Voice Input</button>
            </div>

            <div class="form-group">
                <label class="form-label">ID Type</label>
                <select id="id-type" class="form-select">
                    <option value="national-id">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="driver-license">Driver's License</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">ID Number</label>
                <input type="text" id="id-number" class="form-input" placeholder="Enter ID number">
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" id="phone" class="form-input" placeholder="Enter phone number (international format supported)">
                <div class="helper-text">Supports international phone number formats (e.g., +1234567890)</div>
            </div>

            <!-- Claim Information -->
            <h3 class="subsection-title">Claim Information</h3>
            
            <div class="form-group">
                <label class="form-label">Incident Time</label>
                <input type="datetime-local" id="accident-time" class="form-input">
                <div class="helper-text">Time of accident or first medical consultation for illness</div>
            </div>

            <div class="form-group">
                <label class="form-label">Select Policy</label>
                <div class="policy-selector">
                    <button class="policy-btn active" data-source="recommend">Company Recommended</button>
                    <button class="policy-btn" data-source="self">Self Select</button>
                </div>
            </div>

            <!-- Policy number input shown when Self Select is chosen -->
            <div class="form-group" id="policy-number-group" style="display:none;">
                <label class="form-label">Policy Number</label>
                <input type="text" id="policy-number" class="form-input" placeholder="Please enter policy number">
                <div class="helper-text">Enter your policy number (required if Self Select)</div>
            </div>

            <div class="form-group">
                <label class="form-label">Incident Situation</label>
                <div class="incident-options" id="incident-options">
                    <button class="incident-btn active" data-incident="common-accident">Common Accident</button>
                    <button class="incident-btn" data-incident="traffic-accident">Traffic Accident</button>
                    <button class="incident-btn" data-incident="ordinary-illness">Ordinary Illness</button>
                    <button class="incident-btn" data-incident="serious-illness">Serious Illness</button>
                </div>
            </div>

            <!-- Extra fields for different incident types -->
            <div id="incident-extra-common" class="incident-extra" style="display:none;">
                <div class="form-group">
                    <label class="form-label">Injury Area</label>
                    <input type="text" id="common-injury-area" class="form-input" placeholder="Describe injured area">
                </div>
                <div class="form-group">
                    <label class="form-label">Severity</label>
                    <select id="common-severity" class="form-select">
                        <option value="minor">Minor</option>
                        <option value="major">Major</option>
                    </select>
                </div>
            </div>

            <div id="incident-extra-traffic" class="incident-extra" style="display:none;">
                <div class="form-group">
                    <label class="form-label">Is Motor Vehicle Involved?</label>
                    <select id="traffic-motor" class="form-select">
                        <option value="">Please select</option>
                        <option value="yes">Yes</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Accident Location</label>
                    <input type="text" id="traffic-location" class="form-input" placeholder="Enter location">
                </div>
                <div class="form-group">
                    <label class="form-label">Police Report Number (if any)</label>
                    <input type="text" id="traffic-police-report" class="form-input" placeholder="Enter police report number">
                </div>
            </div>

            <div id="incident-extra-ordinary-illness" class="incident-extra" style="display:none;">
                <div class="form-group">
                    <label class="form-label">Diagnosis Hospital</label>
                    <input type="text" id="illness-hospital" class="form-input" placeholder="Hospital name">
                </div>
                <div class="form-group">
                    <label class="form-label">Diagnosis Summary</label>
                    <textarea id="illness-summary" class="form-input" placeholder="Brief diagnosis summary" rows="3"></textarea>
                </div>
            </div>

            <div id="incident-extra-serious-illness" class="incident-extra" style="display:none;">
                <div class="form-group">
                    <label class="form-label">Diagnosis Details</label>
                    <textarea id="serious-diagnosis" class="form-input" placeholder="Describe diagnosis and dates" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Hospitalization Start Date</label>
                    <input type="date" id="serious-hospital-start" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Hospitalization End Date</label>
                    <input type="date" id="serious-hospital-end" class="form-input">
                </div>
            </div>

            <!-- Agreement Section -->
            <div class="agreement-section">
                <label class="checkbox-container">
                    <input type="checkbox" id="agreement">
                    <span class="checkmark"></span>
                    I have read and agree to the "User Terms and Authorization Agreement" and "Claims Service Personal Information Processing Authorization"
                </label>
            </div>

            <!-- Bottom Buttons -->
            <div class="form-actions">
                <button class="btn-secondary" onclick="saveForm()">Save Draft</button>
                <button class="btn-primary" onclick="nextStep()">Next Step</button>
            </div>
        </section>

        <!-- Step 2: Payment Information -->
        <section id="step-2" class="form-section">
            <h2 class="section-title">Payment Information</h2>
            
            <!-- Payee Information -->
            <h3 class="subsection-title">Payee Information</h3>
            
            <div class="form-group">
                <label class="form-label">Payee Type</label>
                <div class="payee-type">
                    <button class="type-btn active" data-payee="self">Self</button>
                    <button class="type-btn" data-payee="other">Other Person</button>
                    <button class="type-btn" data-payee="company">Company</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Payee Name</label>
                <input type="text" id="payee-name" class="form-input" placeholder="Enter payee name">
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" id="payee-phone" class="form-input" placeholder="Enter payee phone number">
                <button class="clear-btn" onclick="clearField('payee-phone')">
                    <i class="fas fa-times-circle"></i>
                </button>
            </div>

            <!-- Payment Method -->
            <h3 class="subsection-title">Payment Method</h3>
            
            <div class="form-group">
                <div class="payment-method">
                    <div class="method-option active" data-method="bank-card">
                        <i class="fas fa-credit-card"></i>
                        <span>Bank Card</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Bank Card Number</label>
                <input type="text" id="bank-card" class="form-input" placeholder="Enter bank card number" maxlength="19">
                <div class="helper-text">Enter your bank card number (any format accepted)</div>
            </div>

            <div class="form-group">
                <label class="form-label">Bank Name</label>
                <select id="bank-name" class="form-select">
                    <option value="">Select your bank</option>
                    <option value="agricultural-bank">Agricultural Bank of China</option>
                    <option value="industrial-bank">Industrial and Commercial Bank of China</option>
                    <option value="construction-bank">China Construction Bank</option>
                    <option value="bank-of-china">Bank of China</option>
                    <option value="postal-bank">Postal Savings Bank of China</option>
                    <option value="communications-bank">Bank of Communications</option>
                    <option value="merchants-bank">China Merchants Bank</option>
                    <option value="minsheng-bank">China Minsheng Bank</option>
                    <option value="citic-bank">China CITIC Bank</option>
                    <option value="other">Other Bank</option>
                </select>
            </div>

            <!-- Additional Information -->
            <div class="form-group">
                <label class="form-label">Branch Name (Optional)</label>
                <input type="text" id="branch-name" class="form-input" placeholder="Enter branch name (optional)">
            </div>

            <div class="form-group">
                <label class="form-label">Account Holder Relationship</label>
                <select id="account-relationship" class="form-select">
                    <option value="self">Self</option>
                    <option value="spouse">Spouse</option>
                    <option value="parent">Parent</option>
                    <option value="child">Child</option>
                    <option value="sibling">Sibling</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <!-- Verification Note -->
            <div class="verification-note">
                <i class="fas fa-info-circle"></i>
                <p>Please ensure all payment information is accurate. The claim amount will be transferred to the specified bank account after verification.</p>
            </div>
            
            <div class="form-actions">
                <button class="btn-secondary" onclick="prevStep()">Previous Step</button>
                <button class="btn-primary" onclick="nextStep()">Next Step</button>
            </div>
        </section>

        <!-- Step 3: Upload Documents -->
        <section id="step-3" class="form-section">
            <h2 class="section-title">Upload Claim Documents</h2>
            <div class="upload-instructions">
                <h4>Required Documents:</h4>
                <ul>
                    <li>Medical reports and receipts</li>
                    <li>Identity verification documents</li>
                    <li>Incident report or police report (if applicable)</li>
                    <li>Any other supporting documents</li>
                </ul>
            </div>
            
            <!-- File Upload Area -->
            <div class="upload-area">
                <div class="upload-zone" id="upload-zone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Click to upload or drag files here</p>
                    <p class="upload-hint">Supports images (JPG, PNG, GIF) and PDF files, max 10MB each</p>
                    <input type="file" id="file-input" multiple accept="image/*,.pdf">
                </div>
            </div>
            
            <!-- Uploaded Files List (below upload area) -->
            <div id="file-list" class="file-list"></div>
            
            <div class="form-actions">
                <button class="btn-secondary" onclick="prevStep()">Previous Step</button>
                <button class="btn-primary" onclick="submitClaim()">Submit Claim</button>
            </div>
        </section>
    </main>

    <script src="js/app.js"></script>
    <!-- Claim application modal with signature area -->
            <div id="claim-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closeClaimModal()">&times;</button>
            <h3>Claim Application</h3>
            <div id="claim-preview" class="claim-preview">
                <table class="claim-table" id="claim-table">
                    <!-- rows populated by JS -->
                </table>
            </div>
            <div class="signature-area">
                <canvas id="signature-canvas" width="600" height="200"></canvas>
                <div class="signature-actions">
                    <button onclick="clearSignature()" class="btn-secondary">Clear</button>
                    <button onclick="confirmSignature()" class="btn-primary">Confirm & Continue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payee confirmation modal -->
    <div id="payee-confirm-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closePayeeConfirm()">&times;</button>
            <h3>Confirm Payee Information</h3>
            <div id="payee-preview"></div>
            <div class="signature-actions">
                <button class="btn-secondary" onclick="editPayee()">Return to Edit</button>
                <button class="btn-primary" onclick="confirmPayee()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Small instructions for using fetch API -->
    <div id="api-instructions" style="display:none;">
        Use GET /claim-data to retrieve current claim JSON (when service worker registered).
    </div>
</body>
</html>