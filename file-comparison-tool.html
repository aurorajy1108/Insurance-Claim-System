<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Claim File Comparison Tool</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .upload-section { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        .file-input { 
            margin: 10px 0; 
            padding: 10px; 
            border: 2px dashed #ccc; 
            border-radius: 4px; 
        }
        .compare-btn { 
            background: #ff6b35; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
        }
        .compare-btn:hover { 
            background: #e55a2b; 
        }
        .results { 
            margin-top: 20px; 
        }
        .match { 
            color: #28a745; 
            font-weight: bold; 
        }
        .mismatch { 
            color: #dc3545; 
            font-weight: bold; 
        }
        .file-comparison { 
            background: #f8f9fa; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid #ff6b35; 
        }
        .summary { 
            background: #e8f4fd; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0; 
        }
    </style>
</head>
<body>
    <h1>üîç Insurance Claim File Comparison Tool</h1>
    <p>Compare your submitted insurance claim data with ground truth files to verify accuracy.</p>
    
    <div class="upload-section">
        <h3>üìÇ Upload Files for Comparison</h3>
        
        <div class="file-input">
            <label><strong>Ground Truth File:</strong></label><br>
            <input type="file" id="groundTruthFile" accept=".json">
            <div id="groundTruthInfo"></div>
        </div>
        
        <div class="file-input">
            <label><strong>Test File (Your Submission):</strong></label><br>
            <input type="file" id="testFile" accept=".json">
            <div id="testFileInfo"></div>
        </div>
        
        <button class="compare-btn" onclick="compareFiles()">üîç Compare Files</button>
    </div>
    
    <div id="results" class="results"></div>

    <script>
        // File info display
        document.getElementById('groundTruthFile').addEventListener('change', function(e) {
            displayFileInfo('groundTruthInfo', e.target.files[0]);
        });
        
        document.getElementById('testFile').addEventListener('change', function(e) {
            displayFileInfo('testFileInfo', e.target.files[0]);
        });
        
        function displayFileInfo(elementId, file) {
            const element = document.getElementById(elementId);
            if (file) {
                const size = (file.size / 1024).toFixed(2);
                element.innerHTML = `<small>üìÑ ${file.name} (${size} KB)</small>`;
            } else {
                element.innerHTML = '';
            }
        }

        async function compareFiles() {
            const groundTruthFile = document.getElementById('groundTruthFile').files[0];
            const testFile = document.getElementById('testFile').files[0];
            const resultsDiv = document.getElementById('results');
            
            if (!groundTruthFile || !testFile) {
                resultsDiv.innerHTML = '<p class="mismatch">‚ö†Ô∏è Please select both files to compare.</p>';
                return;
            }
            
            try {
                const [truthText, testText] = await Promise.all([
                    groundTruthFile.text(),
                    testFile.text()
                ]);
                
                const truthData = JSON.parse(truthText);
                const testData = JSON.parse(testText);
                
                compareClaimData(truthData, testData);
                
            } catch (error) {
                resultsDiv.innerHTML = `<p class="mismatch">‚ùå Error reading files: ${error.message}</p>`;
            }
        }
        
        function compareClaimData(truth, test) {
            const resultsDiv = document.getElementById('results');
            let html = '<h2>üìä Comparison Results</h2>';
            
            let overallMatch = true;
            
            // Compare form data
            html += '<div class="summary"><h3>üìã Form Data Comparison</h3>';
            const formFields = new Set([...Object.keys(truth.formData || {}), ...Object.keys(test.formData || {})]);
            let formMatches = 0;
            let totalFields = formFields.size;
            
            for (const field of formFields) {
                const truthValue = truth.formData?.[field];
                const testValue = test.formData?.[field];
                const matches = truthValue === testValue;
                
                if (matches) formMatches++;
                else overallMatch = false;
                
                html += `<p><strong>${field}:</strong> `;
                if (matches) {
                    html += `<span class="match">‚úÖ Match</span> (${testValue})`;
                } else {
                    html += `<span class="mismatch">‚ùå Mismatch</span><br>`;
                    html += `&nbsp;&nbsp;Expected: "${truthValue}"<br>`;
                    html += `&nbsp;&nbsp;Got: "${testValue}"`;
                }
                html += '</p>';
            }
            
            html += `<p><strong>Form Data Summary:</strong> ${formMatches}/${totalFields} fields match</p></div>`;
            
            // Compare uploaded files
            html += '<div class="summary"><h3>üìÅ Uploaded Files Comparison</h3>';
            
            const truthFiles = truth.uploadedFiles || [];
            const testFiles = test.uploadedFiles || [];
            
            html += `<p><strong>File Count:</strong> `;
            if (truthFiles.length === testFiles.length) {
                html += `<span class="match">‚úÖ Match (${testFiles.length} files)</span>`;
            } else {
                html += `<span class="mismatch">‚ùå Mismatch</span><br>`;
                html += `&nbsp;&nbsp;Expected: ${truthFiles.length} files<br>`;
                html += `&nbsp;&nbsp;Got: ${testFiles.length} files`;
                overallMatch = false;
            }
            html += '</p>';
            
            // Compare individual files
            const maxFiles = Math.max(truthFiles.length, testFiles.length);
            let fileMatches = 0;
            
            for (let i = 0; i < maxFiles; i++) {
                const truthFile = truthFiles[i];
                const testFile = testFiles[i];
                
                html += '<div class="file-comparison">';
                html += `<h4>üìÑ File ${i + 1}</h4>`;
                
                if (!truthFile) {
                    html += '<p class="mismatch">‚ùå Extra file in test data</p>';
                    overallMatch = false;
                } else if (!testFile) {
                    html += '<p class="mismatch">‚ùå Missing file in test data</p>';
                    overallMatch = false;
                } else {
                    let fileMatch = true;
                    
                    // Compare name
                    const nameMatch = truthFile.name === testFile.name;
                    html += `<p><strong>Name:</strong> ${nameMatch ? '<span class="match">‚úÖ</span>' : '<span class="mismatch">‚ùå</span>'} ${testFile.name}`;
                    if (!nameMatch) {
                        html += ` (Expected: ${truthFile.name})`;
                        fileMatch = false;
                    }
                    html += '</p>';
                    
                    // Compare size
                    const sizeMatch = truthFile.size === testFile.size;
                    html += `<p><strong>Size:</strong> ${sizeMatch ? '<span class="match">‚úÖ</span>' : '<span class="mismatch">‚ùå</span>'} ${testFile.size} bytes`;
                    if (!sizeMatch) {
                        html += ` (Expected: ${truthFile.size} bytes)`;
                        fileMatch = false;
                    }
                    html += '</p>';
                    
                    // Compare type
                    const typeMatch = truthFile.type === testFile.type;
                    html += `<p><strong>Type:</strong> ${typeMatch ? '<span class="match">‚úÖ</span>' : '<span class="mismatch">‚ùå</span>'} ${testFile.type}`;
                    if (!typeMatch) {
                        html += ` (Expected: ${truthFile.type})`;
                        fileMatch = false;
                    }
                    html += '</p>';
                    
                    // Compare content (Base64 data)
                    const dataMatch = truthFile.data === testFile.data;
                    html += `<p><strong>Content:</strong> ${dataMatch ? '<span class="match">‚úÖ IDENTICAL</span>' : '<span class="mismatch">‚ùå DIFFERENT</span>'}`;
                    if (!dataMatch) {
                        html += '<br>&nbsp;&nbsp;<small>File contents do not match - different file or corrupted data</small>';
                        fileMatch = false;
                    }
                    html += '</p>';
                    
                    if (fileMatch) {
                        fileMatches++;
                        html += '<p class="match">üéâ <strong>File completely matches!</strong></p>';
                    } else {
                        overallMatch = false;
                    }
                }
                
                html += '</div>';
            }
            
            html += `<p><strong>Files Summary:</strong> ${fileMatches}/${truthFiles.length} files match completely</p></div>`;
            
            // Overall summary
            html += '<div class="summary"><h2>';
            if (overallMatch) {
                html += 'üéâ <span class="match">PERFECT MATCH!</span>';
                html += '</h2><p>All form data and uploaded files match the ground truth perfectly. Your submission is accurate!</p>';
            } else {
                html += '‚ö†Ô∏è <span class="mismatch">DIFFERENCES FOUND</span>';
                html += '</h2><p>Some differences were found between your submission and the ground truth. Please review the details above.</p>';
            }
            html += '</div>';
            
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>